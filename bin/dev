#!/usr/bin/env ruby
require "fileutils"

# Nettoie les processus et fichiers existants
def cleanup
  # Supprime le fichier PID s'il existe
  pid_file = "tmp/pids/server.pid"
  File.delete(pid_file) if File.exist?(pid_file)
  
  # ArrÃªte les processus sur le port 3000
  system("powershell -Command \"Get-NetTCPConnection -LocalPort 3000 -ErrorAction SilentlyContinue | ForEach-Object { Stop-Process -Id $_.OwningProcess -Force }\"")
end

# Effectue le nettoyage
cleanup

puts "ðŸš€ DÃ©marrage du serveur Rails..."
if Gem.win_platform?
  # DÃ©marre le serveur Rails dans une nouvelle fenÃªtre
  system("start cmd /k rails server")
  
  puts "ðŸŽ¨ DÃ©marrage de Tailwind CSS..."
  # DÃ©marre Tailwind dans une nouvelle fenÃªtre
  system("start cmd /k rails tailwindcss:watch")
else
  system("foreman start -f Procfile.dev")
end

puts "\nâœ¨ Serveur dÃ©marrÃ© ! AccÃ©dez Ã  votre application sur http://localhost:3000"
